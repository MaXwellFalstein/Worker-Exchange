"use strict";var _get=function e(t,n,s){var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,s)}if("value"in r&&r.writable)return r.value;var o=r.get;return void 0===o?void 0:o.call(s)},_inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},_createClass=function(){function e(e,t){for(var n in t){var s=t[n];s.configurable=!0,s.value&&(s.writable=!0)}Object.defineProperties(e,t)}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},EventEmitter=function(){function e(){_classCallCheck(this,e),this.Events={}}return _createClass(e,{on:{value:function(e,t){return this.__validate(e,t),this.Events[e].push(t),this}},once:{value:function(e,t){var n=this;return this.__validate(e,t),this.Events[e].push(function s(){n.off(e,s),t.apply(n,arguments)}),this}},off:{value:function(e,t){if("string"!=typeof e)throw new Error("Invalid Arguments");if(this.Events[e]||(this.Events[e]=[]),"function"==typeof t){var n=this.Events[e].indexOf(t);-1!==n&&this.Events[e].splice(n,1)}else"undefined"==typeof t&&(this.Events[e]=[]);return this}},emit:{value:function(e){var t=this,n=arguments;if("string"!=typeof e)throw new Error("Invalid Arguments");return this.Events[e]||(this.Events[e]=[]),this.Events[e].length&&!function(){var s=Array.prototype.slice.call(n,1),r=t;t.Events[e].forEach(function(e){e.apply(r,s)})}(),this}},__validate:{value:function(e,t){if("string"!=typeof e||"function"!=typeof t)throw new Error("Invalid Arguments");this.Events[e]||(this.Events[e]=[])}}}),e}();"undefined"!=typeof module?module.exports=EventEmitter:"undefined"!=typeof window&&(window.EventEmitter=EventEmitter);var Myself=self,Exchange=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.Ports=[]}return _inherits(t,e),_createClass(t,{Handle:{value:function(e){this.Ports.push(e);var t=this;e.start&&e.start(),e.addEventListener("message",function(n){var s=n.data;s&&s.EXCHANGE&&("Request"===s.Type?(s.Result=null,s.Port=e,t.emit(s.SubType,s.Message,s,e),t.emit("All",s.Message,s)):"Broadcast"===s.Type?(t.emit(s.SubType,s.Message,s,e),t.emit("All",s.Message,s)):"Reply"===s.Type&&t.emit("JOB:"+s.ID,s.Message,e))},!1)}},Send:{value:function(e,t,n){return n=n||this.Ports[0],t=t||"",n.postMessage({Type:"Broadcast",SubType:e,Message:t,EXCHANGE:!0}),this}},Request:{value:function(e,t,n){n=n||this.Ports[0],t=t||"";var s=this;return new Promise(function(r){var i=(Math.random().toString(36)+"00000000000000000").slice(2,9);s.once("JOB:"+i,r),n.postMessage({Type:"Request",SubType:e,Message:t,ID:i,EXCHANGE:!0})})}},Finished:{value:function(e){e.Port.postMessage({Type:"Reply",ID:e.ID,Message:e.Result,EXCHANGE:!0})}}}),t}(EventEmitter);Exchange=new Exchange,self.addEventListener("message",function t(){Exchange.Handle(Myself),Myself.removeEventListener("message",t)}),self.addEventListener("connect",function(e){Exchange.Handle(e.ports[0])});