"use strict";var _prototypeProperties=function(e,r,t){r&&Object.defineProperties(e,r),t&&Object.defineProperties(e.prototype,t)},_classCallCheck=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},Exchange=function(){function e(r){_classCallCheck(this,e);var t=this;this.worker=new Worker(r),this.callbacks={},this.Triggers={},this.debug=!1,this.worker.addEventListener("message",function(e){var r=e.data;t.debug||"debug"===r.Type?console.debug(r):"error"===r.Type&&console.error(r),t.Trigger(r.Type,{ID:r.ID,Data:r.Data,Result:null})}),this.On("job",function(e){var r=e.ID;t.callbacks[r](e.Data),delete t.callbacks[r]})}return _prototypeProperties(e,{Random:{value:function(){return(Math.random()+1).toString(36).substring(7)},writable:!0,configurable:!0}},{Start:{value:function(){this.Send("welcome")},writable:!0,configurable:!0},Trigger:{value:function(e,r){if(this.Triggers.hasOwnProperty(e))for(var t in this.Triggers[e])this.Triggers[e].hasOwnProperty(t)&&this.Triggers[e][t](r)},writable:!0,configurable:!0},On:{value:function(r,t){var i=r.split(".");"undefined"==typeof i[1]&&(i[1]=e.Random()),"undefined"==typeof this.Triggers[i[0]]&&(this.Triggers[i[0]]={}),this.Triggers[i[0]][i[1]]=t},writable:!0,configurable:!0},Off:{value:function(e){var r=this,t=e.split(".");"undefined"==typeof t[1]?delete r.Triggers[t[1]]:delete r.Triggers[t[0]][t[1]]},writable:!0,configurable:!0},Broadcast:{value:function(e,r){r=r||{},this.worker.postMessage({Type:e,Data:r,ID:null})},writable:!0,configurable:!0},Send:{value:function(r,t){var i=this;return t=t||{},new Promise(function(a){var n=e.Random();i.callbacks[n]=a,i.worker.postMessage({Type:r,Data:t,ID:n})})},writable:!0,configurable:!0},Finished:{value:function(e){this.worker.postMessage({Type:"job",Data:e.Result,ID:e.id})},writable:!0,configurable:!0}}),e}();